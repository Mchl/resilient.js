/*! resilient - v0.1 - MIT License - https://github.com/resilient-http/resilient.js */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.resilient=e()}}(function(){var e,t,r;return function n(e,t,r){function s(o,u){if(!t[o]){if(!e[o]){var f=typeof require=="function"&&require;if(!u&&f)return f(o,!0);if(i)return i(o,!0);var a=new Error("Cannot find module '"+o+"'");throw a.code="MODULE_NOT_FOUND",a}var c=t[o]={exports:{}};e[o][0].call(c.exports,function(t){var r=e[o][1][t];return s(r?r:t)},c,c.exports,n,e,t,r)}return t[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(t,r,n){(function(t,s){if(typeof e==="function"&&e.amd){e(["exports"],s)}else if(typeof n==="object"){s(n);if(typeof r==="object"&&r!==null){r.exports=n=n.http}}else{s(t.lil=t.lil||{})}})(this,function(e){"use strict";var t="0.1.9";var r=Object.prototype.toString;var n=Array.prototype.slice;var s=Object.prototype.hasOwnProperty;var i=location.origin;var o=/^(http[s]?:\/\/[a-z0-9\-\.\:]+)[\/]?/i;var u=/application\/json/;var f=typeof XDomainRequest!=="undefined";var a=function(){};var c={method:"GET",timeout:30*1e3,auth:null,headers:null,async:true,withCredentials:false,responseType:"text"};function l(e){return e&&r.call(e)==="[object Object]"||false}function p(e){var t,r,i,o,u=n.call(arguments).slice(1);for(t=0,r=u.length;t<r;t+=1){o=u[t];for(i in o)if(s.call(o,i))e[i]=o[i]}return e}function v(e,t){if(l(t)){t["Content-Type"]=t["Content-Type"]||T.defaultContent;for(var r in t){e.setRequestHeader(r,t[r])}}}function h(e){var t={},r=e.getAllResponseHeaders().split("\n");r.forEach(function(e){if(e){e=e.split(":");t[e[0].trim()]=(e[1]||"").trim()}});return t}function d(e){return u.test(e.getResponseHeader("Content-Type"))}function y(e){return Object.getOwnPropertyNames(e).filter(function(t){return e[t]!==undefined}).map(function(t){var r=e[t]===null?"":e[t];return encodeURIComponent(t)+(r?"="+encodeURIComponent(r):"")}).join("&").replace(/%20/g,"+")}function g(e){var t;if(e.responseType==="text"){t=e.responseText;if(d(e)&&t)t=JSON.parse(t)}else{t=e.response}return t}function m(e){return{xhr:e,status:e.status,data:g(e),headers:h(e)}}function O(e,t){var r=new Error(t.message);p(r,m(e));r.error=t;r.stack=t.stack;return r}function b(e,t){var r=false;return function(n){if(!r){t(O(e,n),null);r=true}}}function S(e,t){return function(){if(e.readyState===4){if(e.status>=200&&e.status<400){t(null,m(e))}else{t(m(e),null)}}}}function w(e){var t=e.match(o);return t&&t[1]===i}function E(e){var t=e.url;if(l(e.params)){t+=(t.indexOf("?")===-1?"?":"&")+y(e.params)}return t}function x(e){if(f&&w(e)){return new XDomainRequest}else{return new XMLHttpRequest}}function _(e){var t=(e.method||"GET").toUpperCase();var r=e.auth||{};var n=E(e);var s=x(n);s.open(t,n,e.async,r.user,r.password);s.withCredentials=e.withCredentials;s.responseType=e.responseType;s.timeout=e.timeout;v(s,e.headers);return s}function R(e,t){return function(e){if(evt.lengthComputable){t(e,evt.loaded/evt.total)}else{t(e)}}}function j(e,t,r){var n=_(e);var s=l(e.data)||Array.isArray(e.data)?JSON.stringify(e.data):e.data;var i=b(n,t);n.onload=S(n,t);n.onerror=i;n.ontimeout=i;n.onabort=i;if(typeof r==="function")n.onprogress=R(n,r);try{n.send(s)}catch(o){i(o)}return{xhr:n,config:e}}function q(e){return function(t,r,s,i){var o,u,f=null;var v=p({},c,{method:e});var h=n.call(arguments);for(o=0,u=h.length;o<u;o+=1){f=h[o];if(typeof f==="function"){s=f;if(s!==f)i=f}else if(l(f)){p(v,f)}else if(typeof f==="string"&&!v.url){v.url=f}}return j(v,s||a,i)}}function T(e,t,r,n){return q("GET").apply(null,arguments)}T.VERSION=t;T.defaults=c;T.defaultContent="text/plain";T.get=q("GET");T.post=q("POST");T.put=q("PUT");T.del=q("DELETE");T.patch=q("PATCH");T.head=q("HEAD");return e.http=T})},{}],2:[function(e,t,r){var n=e("./utils");t.exports=s;function s(){this.store={}}s.prototype.flush=function(e){if(e){this.store[e]=null}else{this.store={}}};s.prototype.get=function(e){return e?this.store[e]:n.clone(this.store)};s.prototype.time=function(e){if(e&&this.store[e]){return this.store[e].time}};s.prototype.exists=function(e){var t=this.store[e];return n.isObj(t)&&(n.isArr(t.data)&&t.data.length>0||n.isObj(t.data))||false};s.prototype.set=function(e,t){if(e&&t){this.store[e]={data:t,time:n.now()}}}},{"./utils":18}],3:[function(e,t,r){var n=e("./utils");var s=e("./resolver");var i=e("./http");t.exports=o;function o(e){this._resilient=e}o.prototype.send=function(e,t,r,n){var s=f.call(this,e,t,r,n);this._resilient.emit("request:start",s[0],this._resilient);u.apply(this,s)};o.prototype.get=function(e,t,r){return this.send(e,t,r,"GET")};o.prototype.post=function(e,t,r){return this.send(e,t,r,"POST")};o.prototype.put=function(e,t,r){return this.send(e,t,r,"PUT")};o.prototype.del=o.prototype.delete=function(e,t,r){return this.send(e,t,r,"DELETE")};o.prototype.patch=function(e,t,r){return this.send(e,t,r,"PATCH")};o.prototype.head=function(e,t,r){return this.send(e,t,r,"HEAD")};function u(e,t){return l(e)?p(e,t):s(this._resilient,e,t)}function f(e,t,r,s){if(typeof t==="function"){r=t;t=arguments[0]}t=c(this._resilient,t);if(typeof e==="string")t.path=e;if(typeof s==="string")t.method=s;if(typeof r!=="function")r=n.noop;return[t,a(this._resilient,r)]}function a(e,t){return n.once(function r(n,s){e.emit("request:finish",n,s,e);t(n,s)})}function c(e,t){var r=e.getOptions("service").get();return n.merge(r,t)}function l(e){return e&&(n.isURI(e.path)||n.isURI(e.url))||false}function p(e,t){if(e.path)e.url=e.path;return i.call(null,e,t)}},{"./http":8,"./resolver":13,"./utils":18}],4:[function(e,t,r){var n=t.exports={};n.service={method:"GET",timeout:10*1e3,servers:null,retry:0,retryWait:1e3,discoverBeforeRetry:true,promiscuousErrors:false};n.balancer={enable:true,roundRobin:true,roundRobinSize:3,weight:{success:15,error:50,latency:35}};n.discovery={servers:null,method:"GET",cache:true,retry:3,retryWait:1e3,timeout:2*1e3,parallel:true,cacheExpiration:60*10*1e3,promiscuousErrors:true,enableRefreshServers:true,refreshInterval:60*1e3,refreshServersInterval:60*3*1e3,refreshServers:null,refreshOptions:null,refreshPath:null,useDiscoveryServersToRefresh:false,discoverBeforeRetry:false};n.resilientOptions=["servers","retry","retryWait","parallel","cacheExpiration","cache","refreshInterval","refreshServers","refreshOptions","refreshPath","enableRefreshServers","refreshServersInterval","discoverBeforeRetry","useDiscoveryServersToRefresh"]},{}],5:[function(e,t,r){var n=e("./utils");var s=e("./error");var i=e("./servers");var o=e("./requester");var u=e("./discovery-servers");var f=e("./servers-discovery");t.exports=a;function a(e,t,r){function n(e){return function t(r,n){i(r,n);e(r,n)}}function s(s){e._updating=true;f(e,t,r)(n(s))}function i(t,r){e._updating=false;e._queue.forEach(o(t,r));e._queue.splice(0)}function o(e,t){return function(r){try{r(e,t)}catch(n){}}}return function u(t){if(e._updating){e._queue.push(t)}else{s(t)}}}o.DiscoveryResolver=a;a.update=function(e,t,r){a(e,t)(u(e)(r))};a.fetch=function(e,t,r){a(e,t)(function n(e,t){if(e)r(e);else if(t&&t.data)r(null,t.data);else r(new s(1001,t))})}},{"./discovery-servers":6,"./error":7,"./requester":11,"./servers":17,"./servers-discovery":16,"./utils":18}],6:[function(e,t,r){var n=e("./utils");var s=e("./error");t.exports=i;function i(e){function t(t,r){var n=t.data;p("refresh",n);e.setServers(n);a(n);r(null,t)}function r(e,t){if(c()){i(e,t)}else{o(e,t)}}function i(e,t){var r=l();if(f(r)){t(null,{status:200,_cache:true,data:r.data})}else{o(e,t)}}function f(t){var r=false,s=e.getOptions("discovery").get("cacheExpiration");return t&&n.isArr(t.data)&&n.now()-t.time>s||false}function a(t){if(c()){p("cache",t);e._cache.set("servers",t)}}function c(){return e.getOptions("discovery").get("cache")}function l(){return e._cache.get("servers")}function p(t,r){e.emit("discovery:"+t,r,e)}return function v(e){return function n(i,o){if(i){r(i,e)}else if(u(o)){t(o,e)}else{e(new s(1004,o))}}}}function o(e,t){e=e||{status:1e3};return t(new s(e.status,e))}function u(e){var t=false;if(e){if(n.isArr(e.data)&&e.data.length){t=true}else if(typeof e.data==="string"){try{e.data=JSON.parse(e.data);t=true}catch(r){}}}return t}},{"./error":7,"./utils":18}],7:[function(e,t,r){t.exports=s;var n={1e3:"All requests failed. No servers available",1001:"Cannot update discovery servers. Empty or invalid response body",1002:"Missing discovery servers. Cannot resolve the server",1003:"Cannot resolve servers. Missing data",1004:"Discovery server response is invalid or empty",1005:"Missing servers during retry process",1006:"Internal unexpected error"};function s(e,t){if(t instanceof Error){Error.call(this);this.error=t;if(t.code)this.code=t.code;if(t.stack)this.stack=t.stack}else if(t){this.request=t}this.status=e||1e3;this.message=n[this.status]}s.prototype=Object.create(Error.prototype);s.MESSAGES=n},{}],8:[function(e,t,r){var n=e("./utils");var s=u();var i=/application\/json/;t.exports=o;function o(){return s.apply(null,arguments)}o.VERSION=s.VERSION;o.mapResponse=a;function u(){if(typeof window==="object"&&window){return e("../bower_components/lil-http/http")}else{return f(e("request"))}}function f(e){return function t(r,n){return e(c(r),a(n))}}function a(e){return function(t,r,n){if(r){if(r.statusCode)r.status=r.statusCode;if(n)r.data=l(r)?JSON.parse(n):n}e(t,r)}}function c(e){if(typeof e==="string")e={url:e};e=p(e);if(e.params)e.qs=e.params;if(e.data)h(e);return e}function l(e){return typeof e.body==="string"&&i.test(e.headers["content-type"])}function p(e){e=e||{};e.headers=e.headers||{};e.headers["User-Agent"]=e.headers["User-Agent"]||v();return e}function v(){return"resilient-http "+o.LIBRARY_VERSION+" (node)"}function h(e){var t=e.data;if(t&&n.isObj(t)||n.isArr(t)){e.json=true;e.data=null}e.body=t}},{"../bower_components/lil-http/http":1,"./utils":18,request:19}],9:[function(e,t,r){var n=e("./resilient");var s=e("./options");var i=e("./defaults");var o=e("./servers");var u=e("./client");var f=e("./http");t.exports=a;function a(e){return new n(e)}a.VERSION="0.2.0";a.CLIENT_VERSION=f.VERSION;a.defaults=i;a.Options=s;a.Servers=o;a.Client=u;a.request=f;f.LIBRARY_VERSION=a.VERSION},{"./client":3,"./defaults":4,"./http":8,"./options":10,"./resilient":12,"./servers":17}],10:[function(e,t,r){var n=e("./utils");var s=e("./defaults");var i=e("./servers");t.exports=o;function o(e,t){this.store=t?n.clone(s[t]):{};this.set(e)}o.prototype.get=function(e){return e?this.store[e]:n.clone(this.store)};o.prototype.set=function(e,t){if(n.isObj(e)){n.each(e,n.bind(this,this.set))}else if(t!==undefined){if(e==="servers"){this.setServers(t)}else{if(e==="refreshServers")t=new i(t);this.store[e]=t}}};o.prototype.http=function(){return n.omit(this.store,s.resilientOptions)};o.prototype.servers=function(e){return e?this.setServers(e):this.store.servers};o.prototype.setServers=function(e){if(this.store.servers){this.store.servers.set(e)}else{this.store.servers=new i(e)}};o.prototype.clone=function(){return o.define(f(this.store))};o.define=function(e,t){var r=new o;t=n.clone(t||s);Object.keys(t).forEach(u(e,r));return r};function u(e,t){e=n.isObj(e)?e:{};return function(r){if(r!=="resilientOptions"){t.set(r,new o(e[r],r))}}}function f(e){var t={};n.each(e,function(e,r){if(r instanceof o){t[e]=r.get()}});return t}},{"./defaults":4,"./servers":17,"./utils":18}],11:[function(e,t,r){var n=e("./utils");var s=e("./http");var i=e("./defaults").resilientOptions;var o=e("./error");var u=e("./discovery-servers");t.exports=f;function f(e){function t(t,r){if(e.balancer().get("enable")){return t.sort(r,e.balancer())}else{return t.get()}}function r(r,i,o,u){var f=O(i.method);var l=t(r,f);i=n.clone(i);function p(t){var v,h=l.shift();if(h){i.url=n.join(h.url,i.basePath,i.path);v=a(h,f,i,o,p);c(e,i,v,u)}else{s(r,i,t,o)}}p()}function s(t,r,n,s){var u=null;if(r.retry){u=i(t,r,s);if(r.discoverBeforeRetry&&e.hasDiscoveryServers()){l(e,u)}else{u()}}else{s(new o(1e3,n))}}function i(e,t,r){return function(){n.delay(u(e,t,r),t.retryWait)}}function u(t,n,s){return function(){if(t.exists()){n.retry-=1;e.emit("request:retry",n,t);r(t,n,s)}else{s(new o(1005))}}}return r}function a(e,t,r,s,i){var o=n.now();return function u(f,a){var c=n.now()-o;if(h(r,f,a)){e.reportError(t,c);i(f)}else{e.report(t,c);p(a,s)}}}function c(e,t,r,s){var o=null;try{o=v(e)(n.omit(t,i),r);if(s)s.push(o)}catch(u){r(u)}}function l(e,t){e._updating=false;f.DiscoveryResolver.update(e,null,t)}function p(e,t){s.mapResponse(t)(null,e,e.body)}function v(e){return typeof e._httpClient==="function"?e._httpClient:s}function h(e,t,r){return e.promiscuousErrors&&g(t||r)||d(t,r)}function d(e,t){return e&&e.code!==undefined||t==undefined||y(e||t)||false}function y(e){return m(429,e)}function g(e){return m(400,e)}function m(e,t){return t&&!t.code&&(t.status>=e||t.status===0)||false}function O(e){return!e||e.toUpperCase()==="GET"?"read":"write"}},{"./defaults":4,"./discovery-servers":6,"./error":7,"./http":8,"./utils":18}],12:[function(e,t,r){var n=e("./utils");var s=e("./options");var i=e("./client");var o=e("./cache");var u=e("./discovery-resolver");var f=e("lil-event");t.exports=a;function a(e){this._options=null;this._queue=[];this._updating=false;this._client=new i(this);this._cache=new o;this._httpClient=null;this.setOptions(e)}a.prototype=Object.create(f.prototype);a.prototype.setOptions=function(e,t){var r=null;if(e&&n.isObj(t)){r=this._options.get(e);if(r instanceof s)r.set(t)}else{this._options=s.define(e)}};a.prototype.setDiscoveryOptions=function(e){this.setOptions("discovery",e);return this};a.prototype.setServiceOptions=function(e){this.setOptions("service",e);return this};a.prototype.getOptions=function(e){return e?this._options.get(e):this._options};a.prototype.getHttpOptions=function(e){var t=this._options.get(e||"service");if(t)return t.http()};a.prototype.servers=function(e){var t=this._options.get(e||"service");if(t)return t.servers()};a.prototype.discoveryServers=function(e){if(n.isArr(e)){this._options.get("discovery").servers(e)}else{return this.servers("discovery")}};a.prototype.hasDiscoveryServers=function(){var e=this.discoveryServers();return n.isObj(e)&&e.exists()||false};a.prototype.setServers=function(e){this._options.get("service").servers(e);return this};a.prototype.getUpdatedServers=a.prototype.getLatestServers=function(e,t){t=typeof e==="function"?e:t;if(this.discoveryServers()){this.discoverServers(e,t)}else if(this.servers("service")){t(null,this.servers("service").urls())}else{t(new Error("Missing servers"))}return this};a.prototype.discoverServers=function(e,t){return p(this,"fetch",e,t)};a.prototype.updateServers=function(e,t){return p(this,"update",e,t)};a.prototype.flushCache=function(){this._cache.flush();return this};a.prototype.useHttpClient=function(e){if(typeof e==="function"){this._httpClient=e}};a.prototype.restoreHttpClient=function(){this._httpClient=null};a.prototype.areServersUpdated=function(){return this.servers("service").lastUpdate()<(this.getOptions("discovery").get("refreshInterval")||0)};a.prototype.balancer=function(e){if(e){this._options.get("balancer").set(e)}else{return this.getOptions("balancer")}};a.prototype.client=a.prototype.http=function(){return this._client};a.prototype.send=a.prototype.request=function(e,t,r){return this._client.send(e,t,r)};a.prototype.mock=function(e){this.useHttpClient(function(t,r){n.delay(function(){e(t,r)})});return this};a.prototype.unmock=function(){this.restoreHttpClient()};var c=["get","post","put","del","delete","head","patch"];c.forEach(l);function l(e){a.prototype[e]=function(t,r,n){return this._client[e](t,r,n)}}function p(e,t,r,s){if(typeof r==="function"){s=r;r=null}u[t](e,r,s||n.noop);return e}},{"./cache":2,"./client":3,"./discovery-resolver":5,"./options":10,"./utils":18,"lil-event":20}],13:[function(e,t,r){var n=e("./utils");var s=e("./error");var i=e("./requester");var o=e("./discovery-resolver");var u=e("./servers-discovery");var f=e("./servers");t.exports=a;function a(e,t,r){try{a(O)}catch(n){r(new s(1006,n))}function a(e){if(d()){v(e)}else if(y()){e()}else if(m()){p(e)}else{e(new s(1002))}}function p(t){o.update(e,null,t)}function v(t){var r=e.getOptions("discovery");var n=c(r);var s=l(r);u(e,s,n)(h(r,t))}function h(e,t){return function(r,n){if(r){t(new s(1001,r))}else if(n&&n.data){e.servers(n.data);if(!y()){p(t)}else{t()}}else{t(new s(1004,r))}}}function d(){var t=false;var r=e.getOptions("discovery");var n=r.get("servers");var s=r.get("refreshServers");if(r.get("enableRefreshServers")){if(r.get("useDiscoveryServersToRefresh")||s&&s.exists()){if(n&&n.exists()){t=n.lastUpdate()>r.get("refreshServersInterval")}else{t=true}}}return t}function y(){var t=e.servers("service");return t&&t.exists()&&g(t)||false}function g(t){var r=true;if(m()){r=t.lastUpdate()<e.getOptions("discovery").get("refreshInterval")}return r}function m(){return e.hasDiscoveryServers()}function O(e,t){if(e){r(e)}else{b(t)}}function b(n){var o=e.servers();if(n&&n._cache){o=new f(n.data)}else if(!y("service")){return r(new s(1003))}i(e)(o,t,r)}}function c(e){return e.get("useDiscoveryServersToRefresh")?e.get("servers"):e.get("refreshServers")}function l(e){var t=n.omit(e.get(),["servers","refreshOptions"]);var r=n.merge(t,e.get("refreshOptions"),{discoverBeforeRetry:false});var s=p(e.get());if(s)r.basePath=s;return r}function p(e){return e&&(e.refreshPath||e.refreshOptions&&e.refreshOptions.basePath)||false}},{"./discovery-resolver":5,"./error":7,"./requester":11,"./servers":17,"./servers-discovery":16,"./utils":18}],14:[function(e,t,r){t.exports=n;function n(e,t){t=t<2?2:t;return s(t,e)[i(t)].shift()}function s(e,t){var r,n,s,i=[];if(!t){t=[];for(r=1;r<=e;r+=1)t.push(r)}else{t=t.slice()}if(e%2===1){t.push(-1);e+=1}for(n=0;n<e-1;n+=1){i[n]=[];for(s=0;s<e/2;s+=1){if(t[s]!==-1&&t[e-1-s]!==-1){i[n].push([t[s],t[e-1-s]])}}t.splice(1,0,t.pop())}return i}function i(e){e=e>0?e-1:e;return Math.round(Math.random()*(e-0)+0)}},{}],15:[function(e,t,r){var n=e("./utils");var s=e("./defaults");t.exports=i;function i(e,t){this.url=e;this.setStats();this.setOptions(t)}i.prototype.report=function(e,t,r){var n=this.getStats(e);if(n){n[r||"request"]+=1;if(t){n.latency=a(t,n)}}};i.prototype.reportError=function(e,t){this.report(e,t,"error")};i.prototype.getBalance=function(e,t){var r=this.getStats(e);var n=this.applyOptions(t).weight;var s=r.request+r.error;return s===0?0:f(r,n,s)};i.prototype.getStats=function(e,t){var r=this.stats[e||"read"];if(r&&t)r=r[t];return r};i.prototype.setOptions=function(e){this.options=n.merge({},s.balancer,e)};i.prototype.applyOptions=function(e){if(n.isObj(e)){return n.merge({},this.options,e)}else{return this.options}};i.prototype.setStats=function(e){this.stats=e||{read:o(),write:o()}};function o(){return{latency:0,error:0,request:0}}function u(){return stats.request*100/total*weight.success}function f(e,t,r){return c((e.request*100/r*t.success+e.error*100/r*t.error+e.latency*t.latency)/100)}function a(e,t){return c((e+t.latency)/(t.request+t.error))}function c(e){return Math.round(e*100)/100}},{"./defaults":4,"./utils":18}],16:[function(e,t,r){var n=e("./utils");var s=e("./error");var i=e("./servers");var o=e("./requester");t.exports=u;function u(e,t,r){function u(){return n.merge(e.getOptions("discovery").get(),t)}function c(){return r||e.servers("discovery")}function l(){var e=c();return e&&e.exists()||false}function p(t){var r=u();r.params=f(r);if(r.parallel){v(r,t)}else{o(e)(c(),r,d(t))}}function v(t,r){var n=[],s=c().sort("read",e.balancer());s.slice(0,3).forEach(function(u,f){u=[u];if(f===2&&s.length>3){u=u.concat(s.slice(3))}o(e)(new i(u),t,h(s,f,n,r),n)})}function h(e,t,r,n){return function(s,i){if(s)r[t]=null;if(i||t===(e.length>3?2:e.length-1)){d(n,r)(s,i)}}}function d(e,t){return function(r,n){a(t);e(r||null,n)}}function y(e){try{p(e)}catch(t){e(new s(1006,t))}}return function g(e){if(l()===false){e(new s(1002))}else{y(e)}}}function f(e){var t=n.now()+Math.floor(Math.random()*1e4);return n.extend(e.params||e.qs||{},{_time:t})}function a(e){if(e){if(!p(e))e.forEach(c);e.splice(0)}}function c(e){if(e){if(e.xhr){if(e.xhr.readyState!==4){l(e.xhr)}}else if(typeof e.abort==="function"){l(e)}}}function l(e){try{e.abort()}catch(t){}}function p(e){return e.filter(function(e){return n.isObj(e)}).length===0}},{"./error":7,"./requester":11,"./servers":17,"./utils":18}],17:[function(e,t,r){var n=e("./utils");var s=e("./server");var i=e("./roundrobin");t.exports=o;function o(e){this.servers=[];this.updated=0;this.force=false;this.set(e)}o.prototype.sort=function(e,t){var r=this.servers.slice(0).sort(function(r,n){return r.getBalance(e,t)-n.getBalance(e,t)});return c(r,t)};o.prototype.find=function(e){var t,r,n=null;for(t=0,r=this.servers.length;t<r;t+=1){if(this.servers[t].url===e){n=this.servers[t];break}}return n};o.prototype.get=function(){return this.servers.slice(0)};o.prototype.set=function(e){if(n.isArr(e)){this.force=true;this.updated=n.now();this.servers=f.call(this,e)}};o.prototype.lastUpdate=function(){return n.now()-this.updated};o.prototype.empty=function(){return this.servers.length===0};o.prototype.exists=function(){return this.size()>0};o.prototype.size=function(){return this.servers.length};o.prototype.forceUpdate=function(){var e=this.force;if(e)this.force=false;return e};o.prototype.urls=function(){return this.servers.map(function(e){return e.url})};function u(e){if(n.isObj(e))e=e.url||e.uri;return n.isURI(e)}function f(e){return e.filter(u).map(n.bind(this,a))}function a(e){var t;if(e instanceof s){t=e}else{t=this.find(n.isObj(e)?e.url:e);if(!t)t=new s(e)}return t}function c(e,t){var r=0;if(t&&t.roundRobin){r=t.roundRobinSize>e.length?e.length:t.roundRobinSize;if(r>1)e=i(e,r)}return e}},{"./roundrobin":14,"./server":15,"./utils":18}],18:[function(e,t,r){var n=r;var s=Object.prototype.toString;var i=Array.prototype.slice;var o=Object.prototype.hasOwnProperty;var u=Function.prototype.bind;var f=Array.isArray;var a=/^http[s]?\:\/\/(.+)/i;n.noop=function h(){};n.now=function(){return(new Date).getTime()};n.isObj=function(e){return e&&s.call(e)==="[object Object]"||false};n.isArr=function(e){return e&&f?f(e):s.call(e)==="[object Array]"||false};n.bind=function(e,t){return u?t.bind(e):function(){return t.apply(e,arguments)}};n.each=function(e,t){var r,s;if(n.isArr(e))for(r=0,s=e.length;r<s;r+=1)t(e[r],r);else if(n.isObj(e))for(r in e)if(o.call(e,r))t(r,e[r])};n.once=function(e){var t=false;return function(){if(t===false){t=true;e.apply(null,arguments)}}};n.clone=function(e){return n.extend({},e)};n.omit=function(e,t){var r,s={};if(n.isObj(e)){for(r in e)if(o.call(e,r)){if(t.indexOf(r)===-1)s[r]=e[r]}}return s};n.delay=function(e,t){return setTimeout(e,t||1)};n.isURI=function(e){return typeof e==="string"&&a.test(e)};n.join=function(e){return(e||"")+i.call(arguments,1).filter(function(e){return typeof e==="string"&&e.length>0}).join("")};n.extend=l(c);n.merge=l(v);function c(e,t,r){e[t]=r}function l(e){return function(t){n.each(i.call(arguments,1),p(t,e));return t}}function p(e,t){return function(r){if(n.isObj(r)){n.each(r,function(r,n){t(e,r,n)})}}}function v(e,t,r){if(n.isObj(r)&&n.isObj(e[t])){n.merge(e[t],r)}else{c(e,t,r)}}},{}],19:[function(e,t,r){},{}],20:[function(t,r,n){(function(t,s){if(typeof e==="function"&&e.amd){e(["exports"],s)}else if(typeof n==="object"){s(n);if(typeof r==="object"&&r!==null){r.exports=n.Event}}else{s(t.lil=t.lil||{})}})(this,function(e){"use strict";var t="0.1.3";var r=Array.prototype.slice;var n=Object.prototype.hasOwnProperty;function s(){}s.prototype.constructor=s;s.prototype.addListener=s.prototype.on=function(e,t,r){if(typeof e!=="string")throw new TypeError("First argument must be a string");if(typeof t!=="function")throw new TypeError("Second argument must be a function");if(!i.call(this,e,t)){o.call(this,e).push({fn:t,once:r||false})}return this};s.prototype.removeListener=s.prototype.off=function(e,t){var r;var n=o.call(this,e);var s=i.call(this,e,t);if(s){r=n.indexOf(s);if(r>=0)n.splice(r,1)}return this};s.prototype.addOnceListener=s.prototype.once=function(e,t,r){this.addListener(e,t,true);return this};s.prototype.emit=s.prototype.fire=function(e){var t,n,s,i=r.call(arguments).slice(1);var u=o.call(this,e);if(e){for(t=0,n=u.length;t<n;t+=1){s=u[t];if(s.once)u.splice(t,1);s.fn.apply(null,i)}}return this};s.prototype.removeAllListeners=s.prototype.offAll=function(e){if(e&&n.call(this._events,e)){this._events[e].splice(0)}return this};function i(e,t){var r,n,s,i=o.call(this,e);for(r=0,n=i.length;r<n;r+=1){s=i[r];if(s.fn===t)return s}}function o(e,t){var r=u.call(this);return n.call(r,e)?r[e]:r[e]=[]}function u(){return this._events||(this._events={})}s.VERSION=t;e.Event=s})},{}]},{},[9])(9)});
//# sourceMappingURL=resilient.min.js.map